## 滑动窗口

| 滑动窗口的定义： | 1.“窗口”对应的是一段可以被发送的字节序列，其连续的范围称为窗口；2.“滑动”则是指这段“允许发送的范围”是可以随着发送的过程而变化的，方式就是按顺序“滑动”。 |
| ---------------- | ------------------------------------------------------------ |
| 滑动窗口的作用： | 是一种流量控制方法，该协议允许发送方在停止等待确认前可以连续发送发个分组。由于发送方不必每发送一个分组就停下来等待确认，因此该协议可以加速数据的传输。 |

基本概念：

| -1 TCP协议的两端分别是发送者A和接受者B，由于是全双工通讯的，因此A and B应该同时维护着一个独立的发送缓冲区和接受缓冲区，由于对等性，我们以A发送B接受的情况作为例子； |
| ------------------------------------------------------------ |
| -2 发送窗口是发送缓存的一部分，是可以被TCP协议发送的那部分，其实应用层需要发送的所有数据都被放进了发送者的发送缓冲区了；当接收方确认数据后，这个滑动窗口不时地向右移动。窗口两个边沿的相对运动增加或减少了窗口的大小。 |
| -3 发送窗口相关的四个概念：已发送并收到确认的数据（不再发送窗口和发送缓冲区之内）；已发送但未收到确认的数据（位于发送窗口之中）；允许发送但尚未发送的数据以及发送窗口外发送缓冲区内暂时不需要发送的数据。 |
| -4 每次成功发送数据之后，发送窗口就会在发送缓冲区中按顺序移动，将新的数据包含到窗口中准备发送。 |

所谓的**流量控制**，主要是接收方传递信息给发送方，使其不要发送数据太快，而是一种端到端的控制。

主要的控制方法：接收窗口通过返回的ACK，其中会包含自己的接受窗口的大小，并且利用大小来控制发送方的数据发送：

![img](E:\笔记\Java面试笔记\images\26275986_1392627535jeG5.png)

这里面涉及到一种情况，如果B已经告诉A自己的缓冲区已满，于是A停止发送数据；等一段时间后，B的缓冲区出现了富余，于是发送报文告诉A我的RWND大小为400，但是这个报文不幸丢失了，于是就出现了A等待B的通知 || B等待A发送数据的死锁状态。

 为了解决这个问题，TCP引入了持续计时器（Persistence timer）当A收到对方的零窗口通知时，就启动该计时器，时间到则发送一个字节的探测报文，对方会在此时回应自身的接受窗口的大小，如果结果仍为0，则重设持续计时器（更新），继续等待。