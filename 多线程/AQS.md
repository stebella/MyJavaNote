## 什么是AQS

AQS(AbstractQueuedSynchronizer)，**AQS是JDK下提供的一套用于实现基于FIFO等待队列的阻塞锁和相关的同步器的一个同步框架**。这个抽象类被设计为作为一些可用原子int值来表示状态的同步器的基类。如果你有看过类似 CountDownLatch 类的源码实现，会发现其内部有一个继承了 AbstractQueuedSynchronizer 的内部类 Sync 。可见 CountDownLatch 是基于AQS框架来实现的一个同步器.类似的同步器在JUC下还有不少。(eg. Semaphore )



AQS的思想就是如果被请求的共享资源空闲的话，就把当前请求的线程设置为有效的线程，并且把共享资源进行锁定，当其它线程来请求的时候，共享资源被占用，就把请求线程放入队列进行等待，如果有效线程任务完成，就按顺序把队列中的线程设置为有效线程。在AQS中state 默认为0，表示没有线程加锁，如果已经加锁则state = 1，有效线程默认为null，如果有加锁线程，则有效线程就是加锁线程，等待队列就是存放等待中的线程的。

## 实现

AQS的实现主要在于维护一个volatile int state（代表共享资源）和一个FIFO线程等待队列（多线程争用资源被阻塞时会进入此队列）。队列中的每个节点是对线程的一个封装，包含线程基本信息，状态，等待的资源类型等。